<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>常州中电新能</title>
    <meta content="demo" name="description">

    <!-- 引入样式 -->
    <link rel="stylesheet" href="css/index.css">
    <script src="js/vue.min.js"></script>


    <!-- 引入组件库 -->
    <script src="js/index.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/print.js"></script>

</head>
<body>
<div id="app">
    <el-row>
        <el-col>
            <el-form :inline="true" :model="searchParams" class="demo-form-inline">
                <el-form-item label="产品编码:">
                    <el-input v-model="searchParams.productCode" placeholder="产品编码"></el-input>
                </el-form-item>
                <el-form-item label="生产数量:">
                    <el-input v-model="searchParams.number" placeholder="生产数量"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" icon="Search" @click="handleQuery">查询</el-button>

                    <el-button type="warning" icon="el-icon-printer" plain @click="handlePrint">打印</el-button>
                    <el-button type="info" icon="el-icon-upload" plain @click="handleImport">导入</el-button>
                </el-form-item>
            </el-form>
        </el-col>
    </el-row>
    <el-row>
        <el-col>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column fixed width="80" label="项目" prop="projectNumber"></el-table-column>
                <el-table-column fixed width="150" label="产品编码" prop="productCode"></el-table-column>
                <el-table-column fixed width="100" label="产品版本" prop="versionNumber"></el-table-column>
                <el-table-column width="200" label="产品名称" prop="productName"></el-table-column>
                <el-table-column width="150" label="子件编码" prop="componentCode"></el-table-column>

                <el-table-column width="600" label="线缆规格型号" prop="cableSpecification"></el-table-column>
                <el-table-column width="100" label="线号（+-）" prop="lineNumber"></el-table-column>
                <el-table-column width="100" label="长度/mm" prop="length"></el-table-column>

                <el-table-column width="100" label="左剥外皮/mm" prop="leftPeelOuter"></el-table-column>
                <el-table-column width="100" label="左剥内皮/mm" prop="leftPeelInner"></el-table-column>
                <el-table-column width="100" label="右剥外皮/mm" prop="rightPeelOuter"></el-table-column>
                <el-table-column width="100" label="右剥内皮/mm" prop="rightPeelInner"></el-table-column>

                <el-table-column width="100" label="标记/喷码" prop="sprayCode"></el-table-column>
                <el-table-column width="100" label="左剥外皮/mm" prop="leftPeelOuterProcess"></el-table-column>
                <el-table-column width="100" label="左屏蔽处理/mm" prop="leftShieldProcess"></el-table-column>
                <el-table-column width="100" label="左剥内皮/mm" prop="leftPeelInnerProcess"></el-table-column>
                <el-table-column width="100" label="右剥外皮/mm" prop="rightPeelOuterProcess"></el-table-column>
                <el-table-column width="100" label="右屏蔽处理/mm" prop="rightShieldProcess"></el-table-column>
                <el-table-column width="100" label="右剥内皮/mm" prop="rightPeelInnerProcess"></el-table-column>
                <el-table-column width="100" label="操作" fixed="right">
                    <template slot-scope="scope">
                        <el-button @click="handleClick(scope.row)" type="text" size="small">查看</el-button>
                    </template>
                </el-table-column>
            </el-table>
            <el-pagination
                    :current-page="searchParams.pageNum"
                    :page-size="searchParams.pageSize"
                    :page-sizes="[10,20,30]"
                    layout="total, sizes, prev, pager, next, jumper"
                    :total="total"
                    @size-change="handleSizeChange"
                    @current-change="handleCurrentPageChange" style="margin-top: 20px">
            </el-pagination>
        </el-col>
    </el-row>

    <el-dialog :title="upload.title" :visible.sync="upload.open">
        <el-upload
                v-loading="upload.loading"
                class="upload-demo"
                ref="upload"
                :limit="1"
                :disabled="upload.disabled"
                accept=".xlsx, .xls"
                action="/cable/upload"
                :on-progress="handleFileUploadProgress"
                :on-success="handleFileSuccess"
                :auto-upload="false">
            <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
            <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器
            </el-button>
            <div slot="tip" class="el-upload__tip">只能上传xls文件，且不超过10M</div>
        </el-upload>
    </el-dialog>

    <el-dialog id="show_detail_info" :title="infoDetail.title" :visible.sync="infoDetail.open" width="70%"
               append-to-body="true">
        <el-row>
            <el-col :span="24">
                <div class="grid-content bg-purple" style="justify-content: center;display: flex;align-items: center;">
                    基础信息
                </div>
            </el-col>
            <el-col>
                <el-table :data="infoDetail.info" border style="width: 100%">
                    <el-table-column width="100" label="项目" prop="projectNumber"></el-table-column>
                    <el-table-column width="150" label="产品编码" prop="productCode"></el-table-column>
                    <el-table-column width="100" label="产品版本" prop="versionNumber"></el-table-column>
                    <el-table-column width="200" label="产品名称" prop="productName"></el-table-column>
                    <el-table-column width="80" label="生产数量" v-if="infoDetail.showNumber">
                        <template slot-scope="scope">
                            {{infoDetail.number}}
                        </template>
                    </el-table-column>
                    <el-table-column width="150" label="子件编码" prop="componentCode"></el-table-column>
                    <el-table-column label="线缆规格型号" prop="cableSpecification"></el-table-column>
                    <el-table-column width="100" label="线号（+-）" prop="lineNumber"></el-table-column>
                </el-table>
            </el-col>
        </el-row>
        <el-row>
            <el-col :span="24">
                <div class="grid-content bg-purple" style="justify-content: center;display: flex;align-items: center;">
                    切线工艺参数
                </div>
            </el-col>
            <el-col>
                <el-table :data="infoDetail.info" border style="width: 100%">
                    <el-table-column label="长度/mm" prop="length"></el-table-column>

                    <el-table-column label="左剥外皮/mm" prop="leftPeelOuter"></el-table-column>
                    <el-table-column label="左剥内皮/mm" prop="leftPeelInner"></el-table-column>
                    <el-table-column label="右剥外皮/mm" prop="rightPeelOuter"></el-table-column>
                    <el-table-column label="右剥内皮/mm" prop="rightPeelInner"></el-table-column>

                    <el-table-column label="标记/喷码" prop="sprayCode"></el-table-column>
                </el-table>
            </el-col>
        </el-row>
        <el-row>
            <el-col :span="24">
                <div class="grid-content bg-purple" style="justify-content: center;display: flex;align-items: center;">
                    线缆处理工艺参数
                </div>
            </el-col>
            <el-col>
                <el-table :data="infoDetail.info" border style="width: 100%">
                    <el-table-column label="左剥外皮/mm" prop="leftPeelOuterProcess"></el-table-column>
                    <el-table-column label="左屏蔽处理/mm" prop="leftShieldProcess"></el-table-column>
                    <el-table-column label="左剥内皮/mm" prop="leftPeelInnerProcess"></el-table-column>
                    <el-table-column label="右剥外皮/mm" prop="rightPeelOuterProcess"></el-table-column>
                    <el-table-column label="右屏蔽处理/mm" prop="rightShieldProcess"></el-table-column>
                    <el-table-column label="右剥内皮/mm" prop="rightPeelInnerProcess"></el-table-column>
                </el-table>
            </el-col>
        </el-row>

    </el-dialog>

</div>
</body>
<script>
    var vm = new Vue({
        el: '#app',
        data() {
            return {
                total: 0,
                upload: {
                    title: '导入',
                    open: false,
                    disabled: false,
                    loading: false
                },
                searchParams: {
                    productCode: '',
                    number: '',
                    pageNum: 1,
                    pageSize: 10,
                },
                tableData: [],
                fileList: [],
                infoDetail: {
                    title: '',
                    showNumber: false,
                    open: false,
                    number: '',
                    info: []
                }
            }
        },
        methods: {
            handlePrint() {
                if (this.searchParams.productCode != '' && this.searchParams.number != '') {

                    axios.get('/cable/print', {params: this.searchParams}).then(resp => {

                        // this.infoDetail.showNumber = true;
                        // this.infoDetail.number = this.searchParams.number;
                        // this.infoDetail.info = resp.data.list;
                        // this.infoDetail.title = "打印";
                        // this.infoDetail.open = true;

                        const windowPrint = window.open('', '')
                        windowPrint.document.write(resp.data.data);
                        windowPrint.document.close();
                        windowPrint.focus();
                        windowPrint.print();
                        windowPrint.close();
                        this.searchParams.productCode = ''
                        this.searchParams.number = ''

                    }).catch((err) => {
                        console.log("11111", err)
                    })
                } else {
                    this.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>请输入 产品编号 和 生产数量 在打印</div>", "导入结果", {dangerouslyUseHTMLString: true});
                }

            },
            handleImport() {
                this.upload.open = true;
            },
            handleClick(row) {

                axios.get('/cable/' + row.id).then(resp => {
                    this.infoDetail.open = true;
                    this.infoDetail.title = "详细信息";
                    this.infoDetail.showNumber = false;
                    this.infoDetail.info = [resp.data.data]
                }).catch((err) => {
                    console.log("11111", err)
                })
            },
            handleQuery() {
                this.searchParams.pageNum = 1;
                this.getList();
            },
            handleSizeChange(size) {
                this.searchParams.pageSize = size;
                this.getList();
            },
            handleCurrentPageChange(newPage) {
                this.searchParams.pageNum = newPage;

                this.getList();
            },
            getList() {
                axios.get('/cable/list', {params: this.searchParams}).then(resp => {

                    this.tableData = resp.data.list;
                    this.total = resp.data.totalRecords;

                }).catch((err) => {
                    console.log("11111", err)
                })
            },
            submitUpload() {
                this.$refs.upload.submit();
            },
            handleFileUploadProgress(event, file, fileList) {
                this.upload.disabled = true;
                this.upload.loading = true;
            },
            handleFileSuccess(response, file, fileList) {
                this.upload.disabled = false;
                this.upload.loading = false;
                if (response.code == 0) {
                    this.upload.open = false;
                    this.$refs.upload.clearFiles();
                    this.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>成功导入：" + response.data + "</div>", "导入结果", {dangerouslyUseHTMLString: true});
                    this.getList();
                } else {
                    this.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>失败：" + response.msg + "</div>", "导入结果", {dangerouslyUseHTMLString: true});
                }
            }
        },
        mounted() {

        },
        created() {
            this.getList();
        }
    });
</script>
<style>
    .el-row {
        margin-bottom: 20px;

    &
    :last-child {
        margin-bottom: 0;
    }

    }
    .el-col {
        border-radius: 4px;
    }

    .bg-purple-dark {
        background: #99a9bf;
    }

    .bg-purple {
        background: #d3dce6;
    }

    .bg-purple-light {
        background: #e5e9f2;
    }

    .grid-content {
        border-radius: 4px;
        min-height: 36px;
    }

    .row-bg {
        padding: 10px 0;
        background-color: #f9fafc;
    }
</style>
</html>